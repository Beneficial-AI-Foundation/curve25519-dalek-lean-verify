# Aeneas Tweaks File
#
# This file contains substitutions to apply to Funs.lean and Types.lean after Aeneas generation.
# Each substitution consists of:
#   ===FIND===  (for literal text matching)
#   OR
#   ===FIND_REGEX===  (for regex pattern matching)
#   <text/pattern to find (can be multiple lines)>
#   ===REPLACE===
#   <replacement text (can be multiple lines)>
#   <blank line>
#
# Notes:
# - Substitutions are applied in order
# - Each substitution replaces ALL occurrences (global replace)
# - ===FIND=== uses literal text matching
# - ===FIND_REGEX=== uses sed regex pattern matching
# - Blank line after ===REPLACE=== marks end of substitution block
# - Lines starting with # are comments
# - Two blank lines required at the end of the file

# Forbidden identifiers

===FIND===
AddAssigncurve25519_dalekbackendserialu64fieldFieldElement51&'a curve25519_dalekbackendserialu64fieldFieldElement51
===REPLACE===
FieldElement51.AddAssign

===FIND===
Mul&0 curve25519_dalekbackendserialu64fieldFieldElement51&'a curve25519_dalekbackendserialu64fieldFieldElement51curve25519_dalekbackendserialu64fieldFieldElement51
===REPLACE===
FieldElement51.Mul

===FIND===
Add&0 curve25519_dalekbackendserialu64fieldFieldElement51&'a curve25519_dalekbackendserialu64fieldFieldElement51curve25519_dalekbackendserialu64fieldFieldElement51
===REPLACE===
FieldElement51.Add

===FIND===
Sub&0 curve25519_dalekbackendserialu64fieldFieldElement51&'a curve25519_dalekbackendserialu64fieldFieldElement51curve25519_dalekbackendserialu64fieldFieldElement51
===REPLACE===
FieldElement51.Sub

===FIND===
Neg&0 curve25519_dalekbackendserialu64fieldFieldElement51curve25519_dalekbackendserialu64fieldFieldElement51
===REPLACE===
FieldElement51

===FIND===
Add&0 curve25519_dalekedwardsEdwardsPoint&'a curve25519_dalekbackendserialcurve_modelsProjectiveNielsPointcurve25519_dalekbackendserialcurve_modelsCompletedPoint
===REPLACE===
CompletedPoint

===FIND===
Add&0 curve25519_dalekedwardsEdwardsPoint&'a curve25519_dalekedwardsEdwardsPointcurve25519_dalekedwardsEdwardsPoint
===REPLACE===
EdwardsPoint

===FIND===
Add&0 curve25519_dalekristrettoRistrettoPoint&'a curve25519_dalekristrettoRistrettoPointcurve25519_dalekristrettoRistrettoPoint
===REPLACE===
RistrettoPoint

===FIND===
def subtle.ConditionallyNegatable.Blanket {T : Type}
  (ConditionallySelectableInst : subtle.ConditionallySelectable T)
  (coreopsarithNeg& TTInst : core.ops.arith.Neg T T) :
  subtle.ConditionallyNegatable T := {
  conditional_negate :=
    subtle.ConditionallyNegatable.Blanket.conditional_negate
    ConditionallySelectableInst coreopsarithNeg& TTInst
}
===REPLACE===
def subtle.ConditionallyNegatable.Blanket {T : Type}
  (ConditionallySelectableInst : subtle.ConditionallySelectable T)
  (coreopsarithNeg_TTInst : core.ops.arith.Neg T T) :
  subtle.ConditionallyNegatable T := {
  conditional_negate :=
    subtle.ConditionallyNegatable.Blanket.conditional_negate
    ConditionallySelectableInst coreopsarithNeg_TTInst
}

# Avoid linter complaints

===FIND===
set_option linter.unusedVariables false
===REPLACE===
set_option linter.unusedVariables false
set_option linter.style.commandStart false

# Other syntax errors

===FIND===
  let i41 ← lift (U64.shr i36 20#i32)
===REPLACE===
  let i41 ← i36 >>> 20#i32

# Add `noncomputable` when required

===FIND===
def scalar.ConstantTimeEqScalar.ct_eq
===REPLACE===
noncomputable def scalar.ConstantTimeEqScalar.ct_eq

===FIND===
def scalar.Scalar.is_canonical
===REPLACE===
noncomputable def scalar.Scalar.is_canonical

===FIND===
def scalar.Scalar.from_canonical_bytes
===REPLACE===
noncomputable def scalar.Scalar.from_canonical_bytes

===FIND===
def subtle.ConstantTimeEqScalar
===REPLACE===
noncomputable def subtle.ConstantTimeEqScalar

===FIND===
def field.ConstantTimeEqFieldElement51.ct_eq
===REPLACE===
noncomputable def field.ConstantTimeEqFieldElement51.ct_eq

===FIND===
def field.FieldElement51.sqrt_ratio_i
===REPLACE===
noncomputable def field.FieldElement51.sqrt_ratio_i

===FIND===
def edwards.CompressedEdwardsY.decompress
===REPLACE===
noncomputable def edwards.CompressedEdwardsY.decompress

===FIND===
def edwards.decompress.step_1
===REPLACE===
noncomputable def edwards.decompress.step_1

===FIND===
def edwards.decompress.step_2
===REPLACE===
noncomputable def edwards.decompress.step_2

===FIND===
def subtle.ConstantTimeEqcurve25519_dalekbackendserialu64fieldFieldElement51
===REPLACE===
noncomputable def subtle.ConstantTimeEqcurve25519_dalekbackendserialu64fieldFieldElement51

===FIND===
def subtle.ConstantTimeEqSlice
===REPLACE===
noncomputable def subtle.ConstantTimeEqSlice

===FIND===
def subtle.ConstantTimeEqEdwardsPoint
===REPLACE===
noncomputable def subtle.ConstantTimeEqEdwardsPoint

===FIND===
def edwards.EdwardsPoint.is_small_order
===REPLACE===
noncomputable def edwards.EdwardsPoint.is_small_order

===FIND===
def edwards.ConstantTimeEqEdwardsPoint.ct_eq
===REPLACE===
noncomputable def edwards.ConstantTimeEqEdwardsPoint.ct_eq

===FIND===
def field.PartialEqFieldElement51FieldElement51.eq
===REPLACE===
noncomputable def field.PartialEqFieldElement51FieldElement51.eq

===FIND===
def core.cmp.PartialEqFieldElement51FieldElement51
===REPLACE===
noncomputable def core.cmp.PartialEqFieldElement51FieldElement51

===FIND===
def montgomery.MontgomeryPoint.to_edwards
===REPLACE===
noncomputable def montgomery.MontgomeryPoint.to_edwards

===FIND===
def field.FieldElement51.is_zero
===REPLACE===
noncomputable def field.FieldElement51.is_zero

===FIND===
def field.FieldElement51.invsqrt
===REPLACE===
noncomputable def field.FieldElement51.invsqrt

===FIND===
def ristretto.decompress.step_1
===REPLACE===
noncomputable def ristretto.decompress.step_1

===FIND===
def ristretto.decompress.step_2
===REPLACE===
noncomputable def ristretto.decompress.step_2

===FIND===
def ristretto.CompressedRistretto.decompress
===REPLACE===
noncomputable def ristretto.CompressedRistretto.decompress

===FIND===
def ristretto.RistrettoPoint.compress
===REPLACE===
noncomputable def ristretto.RistrettoPoint.compress

===FIND===
def ristretto.RistrettoPoint.elligator_ristretto_flavor
===REPLACE===
noncomputable def ristretto.RistrettoPoint.elligator_ristretto_flavor

===FIND===
def ristretto.RistrettoPoint.from_uniform_bytes
===REPLACE===
noncomputable def ristretto.RistrettoPoint.from_uniform_bytes

===FIND===
def core.slice.index.SliceIndexRangeFullSliceSlice
===REPLACE===
noncomputable def core.slice.index.SliceIndexRangeFullSliceSlice

===FIND===
def subtle.ConditionallySelectableU64
===REPLACE===
noncomputable def subtle.ConditionallySelectableU64

===FIND===
def
  backend.serial.u64.field.ConditionallySelectableFieldElement51.conditional_assign
===REPLACE===
noncomputable def
  backend.serial.u64.field.ConditionallySelectableFieldElement51.conditional_assign

===FIND===
def subtle.ConditionallySelectableFieldElement51
===REPLACE===
noncomputable def subtle.ConditionallySelectableFieldElement51

===FIND===
def subtle.ConstantTimeEqFieldElement51
===REPLACE===
noncomputable def subtle.ConstantTimeEqFieldElement51

===FIND===
def zeroize.Zeroize.Blanket
===REPLACE===
noncomputable def zeroize.Zeroize.Blanket

===FIND===
def backend.serial.curve_models.PartialEqAffineNielsPointAffineNielsPoint.eq
===REPLACE===
noncomputable def backend.serial.curve_models.PartialEqAffineNielsPointAffineNielsPoint.eq

===FIND===
def core.cmp.PartialEqAffineNielsPointAffineNielsPoint
===REPLACE===
noncomputable def core.cmp.PartialEqAffineNielsPointAffineNielsPoint

===FIND===
def core.cmp.EqAffineNielsPoint
===REPLACE===
noncomputable def core.cmp.EqAffineNielsPoint

===FIND===
def backend.serial.u64.field.ZeroizeFieldElement51.zeroize
===REPLACE===
noncomputable def backend.serial.u64.field.ZeroizeFieldElement51.zeroize

===FIND===
def backend.serial.curve_models.ZeroizeAffineNielsPoint.zeroize
===REPLACE===
noncomputable def backend.serial.curve_models.ZeroizeAffineNielsPoint.zeroize

===FIND===
def zeroize.ZeroizeAffineNielsPoint
===REPLACE===
noncomputable def zeroize.ZeroizeAffineNielsPoint

===FIND===
def backend.serial.curve_models.ZeroizeProjectiveNielsPoint.zeroize
===REPLACE===
noncomputable def backend.serial.curve_models.ZeroizeProjectiveNielsPoint.zeroize

===FIND===
def zeroize.ZeroizeProjectiveNielsPoint
===REPLACE===
noncomputable def zeroize.ZeroizeProjectiveNielsPoint

===FIND===
def backend.serial.curve_models.ValidityCheckProjectivePoint.is_valid
===REPLACE===
noncomputable def backend.serial.curve_models.ValidityCheckProjectivePoint.is_valid

===FIND===
def traits.ValidityCheckProjectivePoint
===REPLACE===
noncomputable def traits.ValidityCheckProjectivePoint

===FIND===
def backend.serial.curve_models.ConditionallySelectableProjectiveNielsPoint.conditional_assign
===REPLACE===
noncomputable def backend.serial.curve_models.ConditionallySelectableProjectiveNielsPoint.conditional_assign

===FIND===
def subtle.ConditionallySelectableProjectiveNielsPoint
===REPLACE===
noncomputable def subtle.ConditionallySelectableProjectiveNielsPoint

===FIND===
def
  backend.serial.curve_models.ConditionallySelectableAffineNielsPoint.conditional_assign
===REPLACE===
noncomputable def
  backend.serial.curve_models.ConditionallySelectableAffineNielsPoint.conditional_assign

===FIND===
def subtle.ConditionallySelectableAffineNielsPoint
===REPLACE===
noncomputable def subtle.ConditionallySelectableAffineNielsPoint

===FIND===
def zeroize.ZeroizeFieldElement51
===REPLACE===
noncomputable def zeroize.ZeroizeFieldElement51

===FIND===
def zeroize.ZeroizeArray
===REPLACE===
noncomputable def zeroize.ZeroizeArray

===FIND===
def backend.serial.curve_models.ConditionallySelectableProjectiveNielsPoint.conditional_assign
===REPLACE===
noncomputable def backend.serial.curve_models.ConditionallySelectableProjectiveNielsPoint.conditional_assign

===FIND===
def backend.serial.curve_models.ConditionallySelectableAffineNielsPoint.conditional_assign
===REPLACE===
noncomputable def backend.serial.curve_models.ConditionallySelectableAffineNielsPoint.conditional_assign

===FIND===
def
  backend.serial.curve_models.ConditionallySelectableProjectiveNielsPoint.conditional_assign
===REPLACE===
noncomputable def
  backend.serial.curve_models.ConditionallySelectableProjectiveNielsPoint.conditional_assign

# Increase maxRecDepth for to_bytes (large function body exceeds default).
# Must appear before the /- → /-- tweak so the FIND matches raw /- form.
===FIND===
/- [curve25519_dalek::backend::serial::u64::field::{curve25519_dalek::backend::serial::u64::field::FieldElement51}::to_bytes]:
   Source: 'curve25519-dalek/src/backend/serial/u64/field.rs', lines 376:4-458:5 -/
def backend.serial.u64.field.FieldElement51.to_bytes
===REPLACE===
set_option maxRecDepth 4096 in
/- [curve25519_dalek::backend::serial::u64::field::{curve25519_dalek::backend::serial::u64::field::FieldElement51}::to_bytes]:
   Source: 'curve25519-dalek/src/backend/serial/u64/field.rs', lines 376:4-458:5 -/
def backend.serial.u64.field.FieldElement51.to_bytes

# Remove the comment before `noncomputable section` (otherwise the /- → /-- tweak
# below turns it into a doc comment, which is invalid before `section`)

===FIND===
/- You can remove the following line by using the CLI option `-all-computable`: -/
===REPLACE===
-- You can remove the following line by using the CLI option `-all-computable`: 

===FIND===
/- You can set the `maxHeartbeats` value with the `-max-heartbeats` CLI option -/
===REPLACE===
-- You can set the `maxHeartbeats` value with the `-max-heartbeats` CLI option


# Convert Aeneas block comments to doc comments for definitions
===FIND===
/-
===REPLACE===
/--

===FIND===
def core.iter.range.StepUsize
===REPLACE===
noncomputable def core.iter.range.StepUsize

===FIND===
def core.iter.traits.iterator.IteratorRangeA
===REPLACE===
noncomputable def core.iter.traits.iterator.IteratorRangeA

===FIND===
def core.iter.traits.collect.IntoIterator.Blanket
===REPLACE===
noncomputable def core.iter.traits.collect.IntoIterator.Blanket

===FIND===
def subtle.ConditionallySelectableU8
===REPLACE===
noncomputable def subtle.ConditionallySelectableU8

===FIND===
def zeroize.ZeroizeVec
===REPLACE===
noncomputable def zeroize.ZeroizeVec

===FIND===
def backend.serial.u64.scalar.ZeroizeScalar52.zeroize
===REPLACE===
noncomputable def backend.serial.u64.scalar.ZeroizeScalar52.zeroize

===FIND===
def zeroize.ZeroizeScalar52 :
===REPLACE===
noncomputable def zeroize.ZeroizeScalar52 :

===FIND===
def scalar.PartialEqScalarScalar.eq
===REPLACE===
noncomputable def scalar.PartialEqScalarScalar.eq

===FIND===
def core.cmp.PartialEqScalarScalar
===REPLACE===
noncomputable def core.cmp.PartialEqScalarScalar

===FIND===
def core.cmp.EqScalar
===REPLACE===
noncomputable def core.cmp.EqScalar

===FIND===
def scalar.ConditionallySelectableScalar.conditional_select_loop
===REPLACE===
noncomputable def scalar.ConditionallySelectableScalar.conditional_select_loop

===FIND===
def scalar.ConditionallySelectableScalar.conditional_select
  (a : scalar.Scalar) (b : scalar.Scalar) (choice : subtle.Choice) :
===REPLACE===
noncomputable def scalar.ConditionallySelectableScalar.conditional_select
  (a : scalar.Scalar) (b : scalar.Scalar) (choice : subtle.Choice) :

===FIND===
def subtle.ConditionallySelectableScalar
===REPLACE===
noncomputable def subtle.ConditionallySelectableScalar

===FIND===
def scalar.ZeroizeScalar.zeroize
===REPLACE===
noncomputable def scalar.ZeroizeScalar.zeroize

===FIND===
def zeroize.ZeroizeScalar :
===REPLACE===
noncomputable def zeroize.ZeroizeScalar :

===FIND===
def scalar.Scalar.batch_invert
  (inputs :
===REPLACE===
noncomputable def scalar.Scalar.batch_invert
  (inputs :

===FIND===
def core.convert.FromLookupTableProjectiveNielsPointSharedAEdwardsPoint
===REPLACE===
noncomputable def core.convert.FromLookupTableProjectiveNielsPointSharedAEdwardsPoint

===FIND===
def backend.serial.scalar_mul.variable_base.mul_loop
===REPLACE===
noncomputable def backend.serial.scalar_mul.variable_base.mul_loop

# Fix parameter name shadowing: variable `scalar` shadows namespace `scalar`
===FIND===
  let scalar_digits ← scalar.Scalar.as_radix_16 scalar
===REPLACE===
  let scalar_digits ← scalar.as_radix_16

===FIND===
def backend.variable_base_mul
===REPLACE===
noncomputable def backend.variable_base_mul

===FIND===
def edwards.MulShared0EdwardsPointSharedAScalarEdwardsPoint.mul
===REPLACE===
noncomputable def edwards.MulShared0EdwardsPointSharedAScalarEdwardsPoint.mul

===FIND===
def edwards.MulSharedAEdwardsPointScalarEdwardsPoint.mul
===REPLACE===
noncomputable def edwards.MulSharedAEdwardsPointScalarEdwardsPoint.mul

===FIND===
def edwards.EdwardsPoint.is_torsion_free
===REPLACE===
noncomputable def edwards.EdwardsPoint.is_torsion_free

===FIND===
def core.ops.arith.MulShared0EdwardsPointSharedAScalarEdwardsPoint
===REPLACE===
noncomputable def core.ops.arith.MulShared0EdwardsPointSharedAScalarEdwardsPoint

===FIND===
def core.ops.arith.MulSharedAEdwardsPointScalarEdwardsPoint
===REPLACE===
noncomputable def core.ops.arith.MulSharedAEdwardsPointScalarEdwardsPoint

===FIND===
@[reducible, rust_trait_impl "subtle::ConstantTimeEq<u16>"]
def subtle.ConstantTimeEqU16
===REPLACE===
@[rust_trait_impl "subtle::ConstantTimeEq<u16>"]
noncomputable def subtle.ConstantTimeEqU16

===FIND===
def window.FromLookupTableProjectiveNielsPointSharedAEdwardsPoint.from_loop
===REPLACE===
noncomputable def window.FromLookupTableProjectiveNielsPointSharedAEdwardsPoint.from_loop

===FIND===
def window.FromLookupTableProjectiveNielsPointSharedAEdwardsPoint.from
  (P : edwards.EdwardsPoint) :
===REPLACE===
noncomputable def window.FromLookupTableProjectiveNielsPointSharedAEdwardsPoint.from
  (P : edwards.EdwardsPoint) :

===FIND===
def window.LookupTable.select_loop
  {T : Type}
===REPLACE===
noncomputable def window.LookupTable.select_loop
  {T : Type}

===FIND===
def window.LookupTable.select
  {T : Type}
===REPLACE===
noncomputable def window.LookupTable.select
  {T : Type}

===FIND===
def edwards.MulShared0ScalarSharedAEdwardsPointEdwardsPoint.mul
===REPLACE===
noncomputable def edwards.MulShared0ScalarSharedAEdwardsPointEdwardsPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulShared0ScalarSharedAEdwardsPointEdwardsPoint
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulShared0ScalarSharedAEdwardsPointEdwardsPoint

===FIND===
def edwards.MulSharedAScalarEdwardsPointEdwardsPoint.mul
===REPLACE===
noncomputable def edwards.MulSharedAScalarEdwardsPointEdwardsPoint.mul

===FIND===
def edwards.EdwardsPoint.mul_base
===REPLACE===
noncomputable def edwards.EdwardsPoint.mul_base

===FIND===
@[reducible]
def core.ops.arith.MulSharedAScalarEdwardsPointEdwardsPoint
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulSharedAScalarEdwardsPointEdwardsPoint

===FIND===
def edwards.MulScalarEdwardsPointEdwardsPoint.mul
===REPLACE===
noncomputable def edwards.MulScalarEdwardsPointEdwardsPoint.mul

===FIND===
def edwards.EdwardsPoint.mul_clamped
===REPLACE===
noncomputable def edwards.EdwardsPoint.mul_clamped

===FIND===
@[reducible]
def core.ops.arith.MulScalarEdwardsPointEdwardsPoint
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulScalarEdwardsPointEdwardsPoint

# Ristretto Mul impls need noncomputable

===FIND===
def ristretto.MulShared0ScalarSharedARistrettoPointRistrettoPoint.mul
===REPLACE===
noncomputable def ristretto.MulShared0ScalarSharedARistrettoPointRistrettoPoint.mul

===FIND===
def ristretto.MulSharedAScalarRistrettoPointRistrettoPoint.mul
===REPLACE===
noncomputable def ristretto.MulSharedAScalarRistrettoPointRistrettoPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulSharedAScalarRistrettoPointRistrettoPoint
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulSharedAScalarRistrettoPointRistrettoPoint

===FIND===
@[reducible]
def core.ops.arith.MulShared0ScalarSharedARistrettoPointRistrettoPoint
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulShared0ScalarSharedARistrettoPointRistrettoPoint

===FIND===
def ristretto.RistrettoPoint.mul_base
===REPLACE===
noncomputable def ristretto.RistrettoPoint.mul_base

# Rename CompressedRistretto constructor to avoid conflict with type

===FIND===
/-- [curve25519_dalek::ristretto::CompressedRistretto]:
   Source: 'curve25519-dalek/src/ristretto.rs', lines 221:0-221:45 -/
def ristretto.CompressedRistretto
  (a : Array U8 32#usize) : Result ristretto.CompressedRistretto := do
  ok a
===REPLACE===
/-- [curve25519_dalek::ristretto::CompressedRistretto]:
   Source: 'curve25519-dalek/src/ristretto.rs', lines 221:0-221:45 -/
def ristretto.CompressedRistretto.mk
  (a : Array U8 32#usize) : Result ristretto.CompressedRistretto := do
  ok a

# Montgomery functions need noncomputable

===FIND===
def montgomery.MontgomeryPoint.mul_base
  (scalar : scalar.Scalar)
===REPLACE===
noncomputable def montgomery.MontgomeryPoint.mul_base
  (scalar : scalar.Scalar)

===FIND===
def montgomery.MontgomeryPoint.mul_base_clamped
===REPLACE===
noncomputable def montgomery.MontgomeryPoint.mul_base_clamped

===FIND===
def montgomery.elligator_encode
===REPLACE===
noncomputable def montgomery.elligator_encode

# Montgomery ConditionallySelectable and related

===FIND===
@[reducible, rust_trait_impl "subtle::ConditionallySelectable<[@T; @N]>"]
def subtle.ConditionallySelectableArray
===REPLACE===
@[reducible, rust_trait_impl "subtle::ConditionallySelectable<[@T; @N]>"]
noncomputable def subtle.ConditionallySelectableArray

===FIND===
def montgomery.MulShared1MontgomeryPointShared0ScalarMontgomeryPoint.mul_loop
===REPLACE===
noncomputable def montgomery.MulShared1MontgomeryPointShared0ScalarMontgomeryPoint.mul_loop

# Fix parameter name shadowing: variable `scalar` shadows namespace `scalar`
===FIND===
  let scalar_bytes ← scalar.Scalar.as_bytes scalar
===REPLACE===
  let scalar_bytes ← scalar.as_bytes

===FIND===
def montgomery.MulMontgomeryPointSharedBScalarMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulMontgomeryPointSharedBScalarMontgomeryPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulMontgomeryPointSharedBScalarMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulMontgomeryPointSharedBScalarMontgomeryPoint :

===FIND===
def montgomery.MulShared1ScalarShared0MontgomeryPointMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulShared1ScalarShared0MontgomeryPointMontgomeryPoint.mul

===FIND===
def montgomery.MulScalarSharedBMontgomeryPointMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulScalarSharedBMontgomeryPointMontgomeryPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulScalarSharedBMontgomeryPointMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulScalarSharedBMontgomeryPointMontgomeryPoint :

===FIND===
def montgomery.MulSharedAMontgomeryPointScalarMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulSharedAMontgomeryPointScalarMontgomeryPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulSharedAMontgomeryPointScalarMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulSharedAMontgomeryPointScalarMontgomeryPoint :

===FIND===
def montgomery.MulSharedAScalarMontgomeryPointMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulSharedAScalarMontgomeryPointMontgomeryPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulSharedAScalarMontgomeryPointMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulSharedAScalarMontgomeryPointMontgomeryPoint :

===FIND===
def montgomery.MulMontgomeryPointScalarMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulMontgomeryPointScalarMontgomeryPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulMontgomeryPointScalarMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulMontgomeryPointScalarMontgomeryPoint :

===FIND===
def montgomery.MulScalarMontgomeryPointMontgomeryPoint.mul
===REPLACE===
noncomputable def montgomery.MulScalarMontgomeryPointMontgomeryPoint.mul

===FIND===
@[reducible]
def core.ops.arith.MulScalarMontgomeryPointMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulScalarMontgomeryPointMontgomeryPoint :

===FIND===
def montgomery.MulAssignMontgomeryPointShared0Scalar.mul_assign
===REPLACE===
noncomputable def montgomery.MulAssignMontgomeryPointShared0Scalar.mul_assign

===FIND===
def montgomery.MulAssignMontgomeryPointScalar.mul_assign
===REPLACE===
noncomputable def montgomery.MulAssignMontgomeryPointScalar.mul_assign

===FIND===
@[reducible]
def core.ops.arith.MulAssignMontgomeryPointScalar :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulAssignMontgomeryPointScalar :

===FIND===
def montgomery.ConstantTimeEqMontgomeryPoint.ct_eq
===REPLACE===
noncomputable def montgomery.ConstantTimeEqMontgomeryPoint.ct_eq

===FIND===
@[reducible]
def subtle.ConstantTimeEqMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def subtle.ConstantTimeEqMontgomeryPoint :

===FIND===
def montgomery.ConditionallySelectableMontgomeryPoint.conditional_select
===REPLACE===
noncomputable def montgomery.ConditionallySelectableMontgomeryPoint.conditional_select

===FIND===
@[reducible]
def subtle.ConditionallySelectableMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def subtle.ConditionallySelectableMontgomeryPoint :

===FIND===
def montgomery.PartialEqMontgomeryPointMontgomeryPoint.eq
===REPLACE===
noncomputable def montgomery.PartialEqMontgomeryPointMontgomeryPoint.eq

===FIND===
@[reducible]
def core.cmp.PartialEqMontgomeryPointMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.cmp.PartialEqMontgomeryPointMontgomeryPoint :

===FIND===
@[reducible]
def core.cmp.EqMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.cmp.EqMontgomeryPoint :

===FIND===
def montgomery.ZeroizeMontgomeryPoint.zeroize
===REPLACE===
noncomputable def montgomery.ZeroizeMontgomeryPoint.zeroize

===FIND===
@[reducible]
def zeroize.ZeroizeMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def zeroize.ZeroizeMontgomeryPoint :

===FIND===
def montgomery.MontgomeryPoint.mul_clamped
===REPLACE===
noncomputable def montgomery.MontgomeryPoint.mul_clamped

===FIND===
@[reducible]
def subtle.ConditionallySelectableProjectivePoint :
===REPLACE===
@[reducible]
noncomputable def subtle.ConditionallySelectableProjectivePoint :

===FIND===
@[reducible]
def core.ops.arith.MulShared1MontgomeryPointShared0ScalarMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulShared1MontgomeryPointShared0ScalarMontgomeryPoint :

===FIND===
@[reducible]
def core.ops.arith.MulAssignMontgomeryPointShared0Scalar :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulAssignMontgomeryPointShared0Scalar :

===FIND===
@[reducible]
def core.ops.arith.MulShared1ScalarShared0MontgomeryPointMontgomeryPoint :
===REPLACE===
@[reducible]
noncomputable def core.ops.arith.MulShared1ScalarShared0MontgomeryPointMontgomeryPoint :

# Workaround for https://github.com/AeneasVerif/aeneas/issues/815
# Globals referencing fallible globals get incorrect pure return types.

===FIND===
  : Array edwards.EdwardsPoint 8#usize := do
  let a ← backend.serial.u64.constants.EIGHT_TORSION_INNER_DOC_HIDDEN
  a
===REPLACE===
  : Result (Array edwards.EdwardsPoint 8#usize) := do
  let a ← backend.serial.u64.constants.EIGHT_TORSION_INNER_DOC_HIDDEN
  ok a

===FIND===
def constants.RISTRETTO_BASEPOINT_POINT : ristretto.RistrettoPoint := do
  let ep ← backend.serial.u64.constants.ED25519_BASEPOINT_POINT
  ep
===REPLACE===
def constants.RISTRETTO_BASEPOINT_POINT : Result ristretto.RistrettoPoint := do
  let ep ← backend.serial.u64.constants.ED25519_BASEPOINT_POINT
  ok ep

===FIND===
  let ep ←
    Array.index_usize backend.serial.u64.constants.EIGHT_TORSION 2#usize
  let ep1 ←
    edwards.EdwardsPoint.Insts.CoreOpsArithAddEdwardsPointEdwardsPoint.add self
      ep
  let ep2 ←
    Array.index_usize backend.serial.u64.constants.EIGHT_TORSION 4#usize
  let ep3 ←
    edwards.EdwardsPoint.Insts.CoreOpsArithAddEdwardsPointEdwardsPoint.add self
      ep2
  let ep4 ←
    Array.index_usize backend.serial.u64.constants.EIGHT_TORSION 6#usize
===REPLACE===
  let torsion ← backend.serial.u64.constants.EIGHT_TORSION
  let ep ←
    Array.index_usize torsion 2#usize
  let ep1 ←
    edwards.EdwardsPoint.Insts.CoreOpsArithAddEdwardsPointEdwardsPoint.add self
      ep
  let ep2 ←
    Array.index_usize torsion 4#usize
  let ep3 ←
    edwards.EdwardsPoint.Insts.CoreOpsArithAddEdwardsPointEdwardsPoint.add self
      ep2
  let ep4 ←
    Array.index_usize torsion 6#usize

===FIND===
  SharedAScalar.Insts.CoreOpsArithMulRistrettoPointRistrettoPoint.mul scalar
    constants.RISTRETTO_BASEPOINT_POINT
===REPLACE===
  let bp ← constants.RISTRETTO_BASEPOINT_POINT
  SharedAScalar.Insts.CoreOpsArithMulRistrettoPointRistrettoPoint.mul scalar
    bp


