name: Check Status Report

# This workflow ensures that status.md is kept in sync with status.csv.
# The status.csv file is the source of truth for verification progress tracking,
# and status.md is auto-generated from it using scripts/generate-status.py.
#
# This check will fail if someone updates status.csv but forgets to regenerate status.md,
# ensuring the status report visible to users is always up to date.

on:
  pull_request:
  push:

jobs:
  check-status:
    name: Check Status
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Generate status.md
        run: python3 scripts/generate-status.py

      - name: Check if status.md is up to date
        run: |
          if git diff --exit-code status.md; then
            echo "✅ status.md is up to date!"
          else
            echo "❌ status.md is out of date!"
            echo ""
            echo "The status.md file needs to be regenerated from status.csv."
            echo ""
            echo "Please run the following command and commit the updated status.md:"
            echo ""
            echo "  python3 scripts/generate-status.py"
            echo "  git add status.md"
            echo "  git commit -m 'Update status.md'"
            echo ""
            echo "Differences found:"
            git diff status.md
            exit 1
          fi
